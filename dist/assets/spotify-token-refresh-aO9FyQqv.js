import{u as a,S as i}from"./index-B3xspXP-.js";async function c(e){const o=await i.getSession();if(!o)throw new Error("Not authenticated");const n=await fetch("https://lbnuvjrffvcirlenmfvv.supabase.co/functions/v1/refresh-spotify-token",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.access_token}`},body:JSON.stringify({refreshToken:e})});if(!n.ok){const s=await n.json().catch(()=>({error:"Failed to refresh token"}));throw s.code==="INVALID_REFRESH_TOKEN"?(await a.getState().logout(),localStorage.removeItem("spotify_provider_token"),localStorage.removeItem("spotify_provider_refresh_token"),localStorage.removeItem("spotify_token_expires_at"),new Error(s.error||"Invalid refresh token")):new Error(s.error||"Failed to refresh token")}const t=await n.json();return a.getState().setProviderTokens(t.accessToken,e,t.expiresAt),localStorage.setItem("spotify_provider_token",t.accessToken),localStorage.setItem("spotify_provider_refresh_token",e),localStorage.setItem("spotify_token_expires_at",t.expiresAt.toString()),t.accessToken}async function d(){const e=a.getState(),o=e.providerRefreshToken||(typeof window<"u"?localStorage.getItem("spotify_provider_refresh_token"):null);if(!o)return null;if(!e.isTokenExpiringSoon())return e.providerToken||(typeof window<"u"?localStorage.getItem("spotify_provider_token"):null);try{return await c(o)}catch(r){throw console.error("Failed to refresh Spotify token:",r),r}}export{c as refreshSpotifyToken,d as refreshTokenIfNeeded};
